<!DOCTYPE html>

<html lang="en">

    <head>
    <meta charset="UTF-8">
    <title>DeFlyers</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    </head>

    <body>
        <div id="app">
            <div class="container">
                
                <div class="row">
                    <button v-on:click="connectMetamask">Connect to your Metamask account</button>
                    <button v-on:click="checkBalance">Check your AURS Balance</button>
                    <button v-on:click="faucet">Load 5000 AURS on your balance</button>
                    <p class = "jumbotron">okokkkk</p>

                </div>


            </div>

            
        </div>
        <script language="javascript" type="text/javascript" src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
        <script language="javascript" type="text/javascript" src="./deflyers_abi.js" ></script>
        <script language="javascript" type="text/javascript" src="./deflyers_address.js" ></script>
        <script language="javascript" type="text/javascript" src="./deflyersmarket_abi.js" ></script>
        <script language="javascript" type="text/javascript" src="./deflyersmarket_address.js" ></script>
        <script language="javascript" type="text/javascript" src="./aureusfactory_abi.js" ></script>
        <script language="javascript" type="text/javascript" src="./aureusfactory_address.js" ></script>
        <script>


            function getFlyersDetails(id) {
                            return deFlyers.methods.flyers(id).call();
                        }
//            var userAccount = web3.eth.accounts[0];

            //// Update metamask account
            //var accountInterval = setInterval(function() {
            //  // Check if account has changed
            //  if (web3.eth.accounts[0] !== userAccount) {
            //    userAccount = web3.eth.accounts[0];
            //    // Call some function to update the UI with the new account
            //    //updateInterface();
            //  }
            //}, 100);


            
       </script>

       <script>
           var app = new Vue({
                          el:"#app",
                          data: {
                                         account:"",
                                         accounts:"",
                                         deFlyers:"",
                                         deFlyersMarket:"",
                                         aureusFactory:"",
                                     },
                          methods: {
                                         faucet: async function() {
                                                        console.log("appuyé")
                                                        await (this.aureusFactory.methods.faucet().send({from: this.account}));
                                                        await this.checkBalance();
                                                    },
                                         checkBalance:async function() {
                                                        console.log("appuyé");
                                                        await (this.aureusFactory.methods.balanceOf(this.account).call()).then((result) => console.log(result));
                                                    },
                                         checkMetamask: function() {
                                                                // Check if MetaMask is installed
                                                                if (typeof window.ethereum !== 'undefined') {
                                                                    web3js = new Web3(window.ethereum);
                                                                               if(ethereum.isMetaMask){
                                                                                            console.log('MetaMask is installed!');

                                                                                          }
                                                                               else{
                                                                                              console.log("We recommand installing MetaMask");
                                                                                          }
                                                                }
                                                                else {
                                                                    console.log("Please install MetaMask");
                                                                }
                                                                this.startApp();
                                                    },
                                         connectMetamask: async function(){
                                                        this.accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                                                        this.account = app.accounts[0];   
                                                        console.log(app.account);
                                                    },
                                         startApp: function(){
                                                        console.log(aureusfactoryAddresses);
                                                        this.deFlyers = new web3js.eth.Contract(deflyersABI,deflyersAddresses[0]);
                                                        this.deFlyersMarket = new web3js.eth.Contract(deflyersmarketABI,deflyersmarketAddresses[0]);
                                                        this.aureusFactory = new web3js.eth.Contract(aureusfactoryABI,aureusfactoryAddresses[0]);
                                                    }

                                                    

                                     },
                          beforeMount() {
                                         this.checkMetamask();

                                     },
                      })

       </script>
    </body>

</html>

