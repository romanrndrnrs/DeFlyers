<!DOCTYPE html>

<html lang="en">

    <head>
    <meta charset="UTF-8">
    <title>DeFlyers</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    </head>

    <body>
        <div id="app">
            <div class="container">
                
                <div class="row">
                    <button v-on:click="connectMetamask">Connect to your Metamask account</button>
                    <button v-on:click="checkBalance">Check your AURS Balance</button>
                    <button v-on:click="faucet">Load 5000 AURS on your balance</button>
                    <button v-on:click="ownerInitPermissions">Initialise the Market (Only owner !)</button>

                </div>
                <h3>Tokenize your Aircraft:<h3>
                <div class="row">
                    <p class="jumbotron">Aircraft name: <input type="text" v-model="name_input"/></p>
                    <p class="jumbotron">Aircraft description: <input type="text" v-model="description_input"/></p>
                    <p class="jumbotron">Aircraft image: <input type="text" v-model="image_input"/></p>
                    <p class="jumbotron">Aircraft price (in AURS smallest unit): <input type="number" v-model="price_input"/></p>
                    <button v-on:click="createFlyer">Create the Flyer token of your Aircraft</button>
                </div>
                <div class="row">
                    <p class="jumbotron">Get price of aircraft ID<input type="number" v-model="price_id"/></p>
                    <button v-on:click="getPrice">Log the price in console</button>
                </div>


            </div>

            
        </div>
        <script language="javascript" type="text/javascript" src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
        <script language="javascript" type="text/javascript" src="./deflyers_abi.js" ></script>
        <script language="javascript" type="text/javascript" src="./deflyers_address.js" ></script>
        <script language="javascript" type="text/javascript" src="./deflyersmarket_abi.js" ></script>
        <script language="javascript" type="text/javascript" src="./deflyersmarket_address.js" ></script>
        <script language="javascript" type="text/javascript" src="./aureusfactory_abi.js" ></script>
        <script language="javascript" type="text/javascript" src="./aureusfactory_address.js" ></script>
        <script>
            var app = new Vue({
                           el:"#app",
                           data: {
                                           account:"",
                                           accounts:"",
                                           deFlyers:"",
                                           deFlyersMarket:"",
                                           aureusFactory:"",
                                           name_input:"",
                                           description_input:"",
                                           image_input:"",
                                           price_input:"",
                                           buy_id:"",
                                           price_id:"",
                                      },
                           methods: {
                                          faucet: async function() {
                                                         console.log("appuyé")
                                                         await (this.aureusFactory.methods.faucet().send({from: this.account}));
                                                         await this.checkBalance();
                                                     },
                                          checkBalance:async function() {
                                                         console.log("appuyé");
                                                         await (this.aureusFactory.methods.balanceOf(this.account).call()).then((result) => console.log(result));
                                                     },
                                          checkMetamask: function() {
                                                                 // Check if MetaMask is installed
                                                                 if (typeof window.ethereum !== 'undefined') {
                                                                     web3js = new Web3(window.ethereum);
                                                                                if(ethereum.isMetaMask){
                                                                                             console.log('MetaMask is installed!');
 
                                                                                           }
                                                                                else{
                                                                                               console.log("We recommand installing MetaMask");
                                                                                           }
                                                                 }
                                                                 else {
                                                                     console.log("Please install MetaMask");
                                                                 }
                                                                 this.startApp();
                                                     },
                                          connectMetamask: async function(){
                                                         this.accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                                                         this.account = app.accounts[0];   
                                                         console.log(app.account);
                                                     },
                                          startApp: function(){
                                                         console.log(aureusfactoryAddresses);
                                                         this.deFlyers = new web3js.eth.Contract(deflyersABI,deflyersAddresses[0]);
                                                         this.deFlyersMarket = new web3js.eth.Contract(deflyersmarketABI,deflyersmarketAddresses[0]);
                                                         this.aureusFactory = new web3js.eth.Contract(aureusfactoryABI,aureusfactoryAddresses[0]);
                                                     },
                                           
                                           // only owner will be able to use this function
                                           ownerInitPermissions: async function(){
                                                           // Addresses initialisation for the marketplace
                                                           await this.deFlyersMarket.methods.setCurrencyAddress(aureusfactoryAddresses[0]).send({from: this.account});
                                                           await this.deFlyersMarket.methods.setTokenAddress(deflyersAddresses[0]).send({from: this.account});
                                                           // Approve marketplace for token and currency
                                                           await this.deFlyers.methods.manageMarket(deflyersmarketAddresses[0],true).send({from: this.account});
                                                           await this.aureusFactory.methods.manageMarket(deflyersmarketAddresses[0],true).send({from: this.account});
                                                       },
                                           createFlyer: async function(){
                                                           logs = await this.deFlyers.methods.createFlyer(this.name_input,this.description_input,this.image_input,this.price_input).send({from: this.account});
                                                           console.log(logs);
                                                           
                                                       },
                                           buy: async function(){


                                                       },
                                           getPrice: async function(){
                                                           res = await this.deFlyers.methods.getPrice(this.price_id).call();
                                                           console.log(res);
                                                       },
 
                                                     
 
                                      },
                           beforeMount() {
                                          this.checkMetamask();
 
                                      },
                       })
 
        </script>
    </body>

</html>

